{{ 'gls-header.css' | asset_url | stylesheet_tag }}

<header class="gls-header" data-section-id="{{ section.id }}">
  <!-- Top Bar -->
  <div class="gls-header__top-bar">
    <div class="gls-header__container">
      <div class="gls-header__top-left">
        <a href="tel:{{ section.settings.phone_number | replace: ' ', '' | replace: '-', '' }}" class="gls-header__phone">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/>
          </svg>
          Sales: {{ section.settings.phone_number }}
        </a>
        <span class="gls-header__divider">|</span>
        <a href="{{ section.settings.promo_link }}" class="gls-header__promo">
          {{ section.settings.promo_text }}
        </a>
      </div>
      <div class="gls-header__top-right">
        {% for block in section.blocks %}
          {% if block.type == 'top_link' %}
            <a href="{{ block.settings.link }}" class="gls-header__top-link {% if block.settings.highlight %}gls-header__top-link--highlight{% endif %}">
              {{ block.settings.text }}
            </a>
          {% endif %}
        {% endfor %}
      </div>
    </div>
  </div>

  <!-- Main Header -->
  <div class="gls-header__main">
    <div class="gls-header__container">
      <!-- Logo -->
      <a href="{{ routes.root_url }}" class="gls-header__logo-link">
        {% if section.settings.logo != blank %}
          <img 
            src="{{ section.settings.logo | image_url: width: 200 }}" 
            alt="{{ shop.name }}" 
            class="gls-header__logo"
            width="120"
            height="auto"
            loading="eager"
          >
        {% else %}
          <span class="gls-header__logo-text">{{ shop.name }}</span>
        {% endif %}
      </a>

      <!-- Search Bar -->
      <div class="gls-header__search">
        <form action="{{ routes.search_url }}" method="get" class="gls-header__search-form">
          <input type="hidden" name="type" value="product">
          <div class="gls-header__search-wrapper">
            <svg class="gls-header__search-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="11" cy="11" r="8"/>
              <path d="m21 21-4.35-4.35"/>
            </svg>
            <input 
              type="search" 
              name="q" 
              placeholder="{{ section.settings.search_placeholder }}"
              class="gls-header__search-input"
              autocomplete="off"
            >
            <button type="submit" class="gls-header__search-btn">
              {{ section.settings.search_button_text }}
            </button>
          </div>
        </form>
      </div>

      <!-- Account & Cart -->
      <div class="gls-header__actions">
        <!-- Account -->
        <a href="{{ routes.account_url }}" class="gls-header__account">
          <div class="gls-header__account-text">
            <span class="gls-header__account-greeting">HELLO, {% if customer %}{{ customer.first_name | upcase }}{% else %}GUEST{% endif %}</span>
            <span class="gls-header__account-link">My Account <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><path d="m6 9 6 6 6-6"/></svg></span>
          </div>
        </a>

        <!-- Cart -->
        <a href="{{ routes.cart_url }}" class="gls-header__cart">
          <div class="gls-header__cart-icon-wrapper">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
              <line x1="3" y1="6" x2="21" y2="6"/>
              <path d="M16 10a4 4 0 0 1-8 0"/>
            </svg>
            <span class="gls-header__cart-count">{{ cart.item_count }}</span>
          </div>
          <div class="gls-header__cart-text">
            <span class="gls-header__cart-label">CART</span>
            <span class="gls-header__cart-items">{{ cart.item_count }} Items</span>
          </div>
        </a>
      </div>
    </div>
  </div>

  <!-- Navigation Bar -->
  <nav class="gls-header__nav">
    <div class="gls-header__container">
      <!-- Shop Catalog Dropdown -->
      <div class="gls-header__catalog-dropdown">
        <button class="gls-header__catalog-btn" aria-expanded="false" aria-haspopup="true">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="6" x2="21" y2="6"/>
            <line x1="3" y1="12" x2="21" y2="12"/>
            <line x1="3" y1="18" x2="21" y2="18"/>
          </svg>
          <span>{{ section.settings.catalog_text }}</span>
          <svg class="gls-header__catalog-arrow" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <path d="m6 9 6 6 6-6"/>
          </svg>
        </button>
        
        <!-- Mega Menu Dropdown -->
        <div class="gls-header__mega-menu" role="menu">
          <div class="gls-header__mega-menu-inner">
            {% assign mega_categories = section.blocks | where: "type", "mega_category" %}
            {% if mega_categories.size > 0 %}
              {% for block in mega_categories %}
                <div class="gls-header__mega-column" {{ block.shopify_attributes }}>
                  <!-- Category Thumbnail -->
                  <a href="{{ block.settings.category_link | default: '#' }}" class="gls-header__mega-image-link">
                    {% if block.settings.category_image != blank %}
                      <img 
                        src="{{ block.settings.category_image | image_url: width: 400 }}" 
                        alt="{{ block.settings.category_title }}"
                        class="gls-header__mega-image"
                        width="220"
                        height="130"
                        loading="lazy"
                      >
                    {% else %}
                      <div class="gls-header__mega-image-placeholder">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                          <circle cx="8.5" cy="8.5" r="1.5"/>
                          <polyline points="21 15 16 10 5 21"/>
                        </svg>
                      </div>
                    {% endif %}
                  </a>
                  
                  <!-- Category Title -->
                  <a href="{{ block.settings.category_link | default: '#' }}" class="gls-header__mega-title">
                    {{ block.settings.category_title }}
                  </a>
                  
                  <!-- Subcategories List -->
                  <ul class="gls-header__mega-list">
                    {% if block.settings.subcategory_1 != blank %}
                      <li><a href="{{ block.settings.subcategory_1_link | default: '#' }}">{{ block.settings.subcategory_1 }}</a></li>
                    {% endif %}
                    {% if block.settings.subcategory_2 != blank %}
                      <li><a href="{{ block.settings.subcategory_2_link | default: '#' }}">{{ block.settings.subcategory_2 }}</a></li>
                    {% endif %}
                    {% if block.settings.subcategory_3 != blank %}
                      <li><a href="{{ block.settings.subcategory_3_link | default: '#' }}">{{ block.settings.subcategory_3 }}</a></li>
                    {% endif %}
                    {% if block.settings.subcategory_4 != blank %}
                      <li><a href="{{ block.settings.subcategory_4_link | default: '#' }}">{{ block.settings.subcategory_4 }}</a></li>
                    {% endif %}
                    {% if block.settings.subcategory_5 != blank %}
                      <li><a href="{{ block.settings.subcategory_5_link | default: '#' }}">{{ block.settings.subcategory_5 }}</a></li>
                    {% endif %}
                    {% if block.settings.subcategory_6 != blank %}
                      <li><a href="{{ block.settings.subcategory_6_link | default: '#' }}">{{ block.settings.subcategory_6 }}</a></li>
                    {% endif %}
                  </ul>
                  
                  <!-- Request Quote Button -->
                  <a href="{{ block.settings.quote_link | default: section.settings.quote_link | default: '#' }}" class="gls-header__mega-quote-btn">
                    Request Quote
                  </a>
                </div>
              {% endfor %}
            {% else %}
              <!-- Fallback when no categories are configured -->
              <div class="gls-header__mega-empty">
                <p>No categories configured. Add "Mega Menu Category" blocks in the theme editor.</p>
              </div>
            {% endif %}
          </div>
        </div>
      </div>

      <!-- Main Menu Items -->
      <ul class="gls-header__menu">
        {% for link in linklists[section.settings.main_menu].links %}
          <li class="gls-header__menu-item">
            <a href="{{ link.url }}" class="gls-header__menu-link {% if link.active %}gls-header__menu-link--active{% endif %}">
              {{ link.title }}
            </a>
          </li>
        {% endfor %}
      </ul>

      <!-- Request Quote Button (Right Side) -->
      <a href="{{ section.settings.quote_link | default: '#' }}" class="gls-header__quote-btn">
        {{ section.settings.quote_text }}
      </a>

      <!-- Mobile Menu Toggle -->
      <button class="gls-header__mobile-toggle" aria-label="Toggle menu" aria-expanded="false">
        <svg class="gls-header__mobile-toggle-open" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <line x1="3" y1="6" x2="21" y2="6"/>
          <line x1="3" y1="12" x2="21" y2="12"/>
          <line x1="3" y1="18" x2="21" y2="18"/>
        </svg>
        <svg class="gls-header__mobile-toggle-close" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display: none;">
          <line x1="18" y1="6" x2="6" y2="18"/>
          <line x1="6" y1="6" x2="18" y2="18"/>
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile Menu Drawer -->
  <div class="gls-header__mobile-menu">
    <div class="gls-header__mobile-menu-inner">
      <ul class="gls-header__mobile-nav">
        {% for link in linklists[section.settings.main_menu].links %}
          <li>
            <a href="{{ link.url }}" class="{% if link.active %}active{% endif %}">{{ link.title }}</a>
          </li>
        {% endfor %}
      </ul>
      <a href="{{ section.settings.quote_link | default: '#' }}" class="gls-header__mobile-quote-btn">
        {{ section.settings.quote_text }}
      </a>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // ========================================
    // Mega Menu Functionality
    // ========================================
    const catalogDropdown = document.querySelector('.gls-header__catalog-dropdown');
    const catalogBtn = document.querySelector('.gls-header__catalog-btn');
    const megaMenu = document.querySelector('.gls-header__mega-menu');
    
    if (catalogBtn && megaMenu && catalogDropdown) {
      let hoverTimeout;
      let isMenuOpen = false;
      const isTouchDevice = 'ontouchstart' in window || navigator.maxTouchPoints > 0;

      function openMegaMenu() {
        clearTimeout(hoverTimeout);
        catalogBtn.setAttribute('aria-expanded', 'true');
        megaMenu.classList.add('is-open');
        catalogDropdown.classList.add('is-active');
        isMenuOpen = true;
      }

      function closeMegaMenu() {
        catalogBtn.setAttribute('aria-expanded', 'false');
        megaMenu.classList.remove('is-open');
        catalogDropdown.classList.remove('is-active');
        isMenuOpen = false;
      }

      // Click handler for toggle
      catalogBtn.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        if (isMenuOpen) {
          closeMegaMenu();
        } else {
          openMegaMenu();
        }
      });

      // Hover handlers for desktop (non-touch devices)
      if (!isTouchDevice) {
        catalogDropdown.addEventListener('mouseenter', function() {
          openMegaMenu();
        });

        catalogDropdown.addEventListener('mouseleave', function() {
          hoverTimeout = setTimeout(function() {
            closeMegaMenu();
          }, 200);
        });

        megaMenu.addEventListener('mouseenter', function() {
          clearTimeout(hoverTimeout);
        });

        megaMenu.addEventListener('mouseleave', function() {
          hoverTimeout = setTimeout(function() {
            closeMegaMenu();
          }, 200);
        });
      }

      // Close on outside click
      document.addEventListener('click', function(e) {
        if (!e.target.closest('.gls-header__catalog-dropdown')) {
          closeMegaMenu();
        }
      });

      // Close on Escape key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape') {
          closeMegaMenu();
        }
      });
    }

    // ========================================
    // Mobile Menu Functionality
    // ========================================
    const mobileToggle = document.querySelector('.gls-header__mobile-toggle');
    const mobileMenu = document.querySelector('.gls-header__mobile-menu');
    const openIcon = document.querySelector('.gls-header__mobile-toggle-open');
    const closeIcon = document.querySelector('.gls-header__mobile-toggle-close');

    if (mobileToggle && mobileMenu) {
      let isMobileMenuOpen = false;

      function openMobileMenu() {
        mobileMenu.classList.add('is-open');
        mobileToggle.setAttribute('aria-expanded', 'true');
        if (openIcon) openIcon.style.display = 'none';
        if (closeIcon) closeIcon.style.display = 'block';
        document.body.style.overflow = 'hidden';
        isMobileMenuOpen = true;
      }

      function closeMobileMenu() {
        mobileMenu.classList.remove('is-open');
        mobileToggle.setAttribute('aria-expanded', 'false');
        if (openIcon) openIcon.style.display = 'block';
        if (closeIcon) closeIcon.style.display = 'none';
        document.body.style.overflow = '';
        isMobileMenuOpen = false;
      }

      mobileToggle.addEventListener('click', function() {
        if (isMobileMenuOpen) {
          closeMobileMenu();
        } else {
          openMobileMenu();
        }
      });

      // Close mobile menu on window resize to desktop
      window.addEventListener('resize', function() {
        if (window.innerWidth > 991 && isMobileMenuOpen) {
          closeMobileMenu();
        }
      });
    }

    // ========================================
    // Sticky Header Scroll Animation
    // ========================================
    const headerSection = document.querySelector('.gls-header-section');
    if (headerSection) {
      let lastScrollY = window.scrollY;
      let ticking = false;
      const scrollThreshold = 100;

      function updateHeader() {
        const currentScrollY = window.scrollY;

        // Add scrolled class when scrolled past threshold
        if (currentScrollY > scrollThreshold) {
          headerSection.classList.add('is-scrolled');
        } else {
          headerSection.classList.remove('is-scrolled');
        }

        // Hide header when scrolling down, show when scrolling up
        if (currentScrollY > lastScrollY && currentScrollY > 200) {
          // Scrolling down & past 200px
          headerSection.classList.add('is-hidden');
        } else {
          // Scrolling up
          headerSection.classList.remove('is-hidden');
        }

        lastScrollY = currentScrollY;
        ticking = false;
      }

      window.addEventListener('scroll', function() {
        if (!ticking) {
          window.requestAnimationFrame(updateHeader);
          ticking = true;
        }
      }, { passive: true });
    }
  });
</script>

{% schema %}
{
  "name": "GLS Header",
  "class": "gls-header-section",
  "settings": [
    {
      "type": "header",
      "content": "Logo"
    },
    {
      "type": "image_picker",
      "id": "logo",
      "label": "Logo Image"
    },
    {
      "type": "image_picker",
      "id": "logo_mobile",
      "label": "Mobile Logo (optional)"
    },
    {
      "type": "header",
      "content": "Top Bar"
    },
    {
      "type": "text",
      "id": "phone_number",
      "label": "Sales Phone Number",
      "default": "+1 862-237-7067"
    },
    {
      "type": "text",
      "id": "promo_text",
      "label": "Promotional Text",
      "default": "Net-30 Terms Available for Qualified Buyers"
    },
    {
      "type": "url",
      "id": "promo_link",
      "label": "Promotional Link"
    },
    {
      "type": "header",
      "content": "Search"
    },
    {
      "type": "text",
      "id": "search_placeholder",
      "label": "Search Placeholder",
      "default": "Search SKUs, product names, or categories..."
    },
    {
      "type": "text",
      "id": "search_button_text",
      "label": "Search Button Text",
      "default": "SEARCH"
    },
    {
      "type": "header",
      "content": "Navigation"
    },
    {
      "type": "text",
      "id": "catalog_text",
      "label": "Shop Catalog Button Text",
      "default": "Shop Catalog"
    },
    {
      "type": "link_list",
      "id": "catalog_menu",
      "label": "Catalog Menu",
      "default": "main-menu"
    },
    {
      "type": "link_list",
      "id": "main_menu",
      "label": "Main Menu",
      "default": "main-menu"
    },
    {
      "type": "header",
      "content": "Request Quote"
    },
    {
      "type": "text",
      "id": "quote_text",
      "label": "Quote Button Text",
      "default": "REQUEST QUOTE"
    },
    {
      "type": "url",
      "id": "quote_link",
      "label": "Quote Button Link"
    }
  ],
  "blocks": [
    {
      "type": "top_link",
      "name": "Top Bar Link",
      "settings": [
        {
          "type": "text",
          "id": "text",
          "label": "Link Text",
          "default": "Support"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link URL"
        },
        {
          "type": "checkbox",
          "id": "highlight",
          "label": "Highlight Link (colored)",
          "default": false
        }
      ]
    },
    {
      "type": "mega_category",
      "name": "Mega Menu Category",
      "settings": [
        {
          "type": "header",
          "content": "Category Info"
        },
        {
          "type": "image_picker",
          "id": "category_image",
          "label": "Category Thumbnail"
        },
        {
          "type": "text",
          "id": "category_title",
          "label": "Category Title",
          "default": "Category Name"
        },
        {
          "type": "url",
          "id": "category_link",
          "label": "Category Link"
        },
        {
          "type": "header",
          "content": "Subcategories"
        },
        {
          "type": "text",
          "id": "subcategory_1",
          "label": "Subcategory 1"
        },
        {
          "type": "url",
          "id": "subcategory_1_link",
          "label": "Subcategory 1 Link"
        },
        {
          "type": "text",
          "id": "subcategory_2",
          "label": "Subcategory 2"
        },
        {
          "type": "url",
          "id": "subcategory_2_link",
          "label": "Subcategory 2 Link"
        },
        {
          "type": "text",
          "id": "subcategory_3",
          "label": "Subcategory 3"
        },
        {
          "type": "url",
          "id": "subcategory_3_link",
          "label": "Subcategory 3 Link"
        },
        {
          "type": "text",
          "id": "subcategory_4",
          "label": "Subcategory 4"
        },
        {
          "type": "url",
          "id": "subcategory_4_link",
          "label": "Subcategory 4 Link"
        },
        {
          "type": "text",
          "id": "subcategory_5",
          "label": "Subcategory 5"
        },
        {
          "type": "url",
          "id": "subcategory_5_link",
          "label": "Subcategory 5 Link"
        },
        {
          "type": "text",
          "id": "subcategory_6",
          "label": "Subcategory 6"
        },
        {
          "type": "url",
          "id": "subcategory_6_link",
          "label": "Subcategory 6 Link"
        },
        {
          "type": "header",
          "content": "Request Quote"
        },
        {
          "type": "url",
          "id": "quote_link",
          "label": "Quote Button Link (optional)",
          "info": "Leave blank to use the main Quote Button link"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "GLS Header",
      "blocks": [
        {
          "type": "top_link",
          "settings": {
            "text": "Support",
            "highlight": false
          }
        },
        {
          "type": "top_link",
          "settings": {
            "text": "Track Order",
            "highlight": false
          }
        },
        {
          "type": "top_link",
          "settings": {
            "text": "Apply for Credit",
            "highlight": true
          }
        },
        {
          "type": "mega_category",
          "settings": {
            "category_title": "Food Packaging",
            "subcategory_1": "Fast-food boxes",
            "subcategory_2": "Takeout bags",
            "subcategory_3": "Beverage cups",
            "subcategory_4": "Eco-friendly packaging"
          }
        },
        {
          "type": "mega_category",
          "settings": {
            "category_title": "Disposable Tableware",
            "subcategory_1": "Plates",
            "subcategory_2": "Bowls",
            "subcategory_3": "Cutlery",
            "subcategory_4": "Trays"
          }
        },
        {
          "type": "mega_category",
          "settings": {
            "category_title": "Napkins & Sanitary",
            "subcategory_1": "Paper napkins",
            "subcategory_2": "Wet wipes",
            "subcategory_3": "Gloves",
            "subcategory_4": "Polyethylene bags",
            "subcategory_5": "Sanitizers"
          }
        },
        {
          "type": "mega_category",
          "settings": {
            "category_title": "Food & Liquid",
            "subcategory_1": "Sauces",
            "subcategory_2": "Oil",
            "subcategory_3": "Breading Material"
          }
        }
      ]
    }
  ]
}
{% endschema %}
