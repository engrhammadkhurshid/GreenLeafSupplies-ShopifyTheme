{{ 'gls-blog.css' | asset_url | stylesheet_tag }}

{%- style -%}
  .section-{{ section.id }}-padding {
    padding-top: {{ section.settings.padding_top | times: 0.75 | round: 0 }}px;
    padding-bottom: {{ section.settings.padding_bottom | times: 0.75 | round: 0 }}px;
  }

  @media screen and (min-width: 750px) {
    .section-{{ section.id }}-padding {
      padding-top: {{ section.settings.padding_top }}px;
      padding-bottom: {{ section.settings.padding_bottom }}px;
    }
  }

  /* Header / Icon Box Styles */
  .gls-blog-header-wrapper {
    background-color: {{ section.settings.header_bg_color }};
    width: 100%;
    display: flex;
    justify-content: center;
    padding: 60px 20px;
    margin-bottom: 40px;
  }

  .gls-blog-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 24px;
    max-width: 1200px;
  }

  .gls-blog-header--top {
    flex-direction: column;
    text-align: center;
  }

  .gls-blog-header--left {
    flex-direction: row;
    text-align: left;
  }

  .gls-blog-header__icon {
    display: flex;
    align-items: center;
    justify-content: center;
    color: {{ section.settings.icon_color }};
    flex-shrink: 0;
  }
  
  .gls-blog-header__icon svg,
  .gls-blog-header__icon img {
    width: {{ section.settings.icon_width }}px;
    height: auto;
    display: block;
  }

  .gls-blog-header__content {
    display: flex;
    flex-direction: column;
  }

  .gls-blog-header__title {
    margin: 0;
    line-height: 1.2;
    color: {{ section.settings.heading_color }};
    font-size: {{ section.settings.heading_size }}px;
  }

  .gls-blog-header__tagline {
    margin: 8px 0 0 0;
    line-height: 1.4;
    color: {{ section.settings.tagline_color }};
    font-size: {{ section.settings.tagline_size }}px;
  }

  /* Sidebar & Grid Styles */
  #shopify-section-{{ section.id }} .gls-blog-sidebar {
    background-color: {{ section.settings.sidebar_bg_color }};
  }
  #shopify-section-{{ section.id }} .gls-blog-sidebar__title {
    color: {{ section.settings.sidebar_title_color }};
    font-size: {{ section.settings.sidebar_title_size }}px;
  }
  
  #shopify-section-{{ section.id }} .gls-article-card__title {
    font-size: {{ section.settings.article_title_size }}px;
    color: {{ section.settings.article_title_color }};
  }
  #shopify-section-{{ section.id }} .gls-article-card__button {
    background-color: {{ section.settings.button_bg_color }};
    color: {{ section.settings.button_text_color }};
  }
  #shopify-section-{{ section.id }} .gls-article-card__button:hover {
    background-color: {{ section.settings.button_bg_color | color_darken: 10 }};
  }
{%- endstyle -%}

<div class="gls-blog-page section-{{ section.id }}-padding">
  
  <!-- Icon Box Header -->
  <div class="gls-blog-header-wrapper">
    <div class="gls-blog-header gls-blog-header--{{ section.settings.icon_position }}">
      
      {%- if section.settings.show_icon -%}
        <div class="gls-blog-header__icon">
          {%- if section.settings.custom_icon != blank -%}
            {{ section.settings.custom_icon | image_url: width: section.settings.icon_width | image_tag: loading: 'lazy' }}
          {%- else -%}
            {%- case section.settings.icon -%}
              {%- when 'leaf' -%}
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17,8C8,10 5.9,16.17 3.82,21.34L5.71,22L6.66,19.7C7.14,19.87 7.64,20 8,20C19,20 22,3 22,3C21,5 14,5.25 9,6.25C4,7.25 2,11.5 2,13.5C2,15.5 3.75,17.25 3.75,17.25C7,8 17,8 17,8Z" /></svg>
              {%- when 'box' -%}
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5A2,2 0 0,0 19,3M19,19H5V5H19V19Z" /></svg>
              {%- when 'star' -%}
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12,17.27L18.18,21L16.54,13.97L22,9.24L14.81,8.62L12,2L9.19,8.62L2,9.24L7.45,13.97L5.82,21L12,17.27Z" /></svg>
              {%- when 'heart' -%}
                <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12,21.35L10.55,20.03C5.4,15.36 2,12.27 2,8.5C2,5.41 4.42,3 7.5,3C9.24,3 10.91,3.81 12,5.08C13.09,3.81 14.76,3 16.5,3C19.58,3 22,5.41 22,8.5C22,12.27 18.6,15.36 13.45,20.03L12,21.35Z" /></svg>
              {%- else -%}
                 <svg viewBox="0 0 24 24" fill="currentColor"><path d="M17,8C8,10 5.9,16.17 3.82,21.34L5.71,22L6.66,19.7C7.14,19.87 7.64,20 8,20C19,20 22,3 22,3C21,5 14,5.25 9,6.25C4,7.25 2,11.5 2,13.5C2,15.5 3.75,17.25 3.75,17.25C7,8 17,8 17,8Z" /></svg>
            {%- endcase -%}
          {%- endif -%}
        </div>
      {%- endif -%}

      <div class="gls-blog-header__content">
        {%- assign HeadingTag = section.settings.heading_tag | default: 'h1' -%}
        <{{ HeadingTag }} class="gls-blog-header__title">
          {% if section.settings.heading_text != blank %}
            {{ section.settings.heading_text }}
          {% else %}
            {{ blog.title }}
          {% endif %}
        </{{ HeadingTag }}>
        
        {% if section.settings.tagline_text != blank %}
          <p class="gls-blog-header__tagline">{{ section.settings.tagline_text }}</p>
        {% endif %}
      </div>

    </div>
  </div>

  <div class="gls-blog-container">
    
    <!-- Sidebar -->
    <aside class="gls-blog-sidebar">
      {% if section.settings.show_search %}
        <div class="gls-blog-sidebar__section">
          <h3 class="gls-blog-sidebar__title">Search</h3>
          <form action="{{ routes.search_url }}" method="get" class="gls-blog-search">
            <input type="hidden" name="type" value="article">
            <input type="text" name="q" placeholder="Search articles..." value="{{ search.terms | escape }}">
            <button type="submit">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
              </svg>
            </button>
          </form>
        </div>
      {% endif %}

      {% if section.settings.show_categories %}
        <div class="gls-blog-sidebar__section">
          <h3 class="gls-blog-sidebar__title">Categories</h3>
          <ul class="gls-blog-categories-list">
            <li>
              <a href="{{ blog.url }}" class="{% unless current_tags %}active{% endunless %}">
                All Posts
                <span>{{ blog.articles_count }}</span>
              </a>
            </li>
            {% for tag in blog.all_tags %}
              <li>
                <a href="{{ blog.url }}/tagged/{{ tag | handle }}" class="{% if current_tags contains tag %}active{% endif %}">
                  {{ tag }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </aside>

    <!-- Main Content -->
    <div class="gls-blog-main">
      
      <!-- Featured Categories Grid -->
      {% if section.blocks.size > 0 %}
        <div class="gls-blog-featured-cats">
          {% for block in section.blocks %}
            {% if block.type == 'category' %}
              <a href="{{ blog.url }}/tagged/{{ block.settings.tag | handle }}" class="gls-blog-cat-card" {{ block.shopify_attributes }}>
                {% if block.settings.image != blank %}
                  <img src="{{ block.settings.image | image_url: width: 400 }}" alt="{{ block.settings.tag }}" loading="lazy">
                {% else %}
                  {{ 'collection-1' | placeholder_svg_tag }}
                {% endif %}
                <div class="gls-blog-cat-card__overlay"></div>
                <span class="gls-blog-cat-card__title">{{ block.settings.tag }}</span>
              </a>
            {% endif %}
          {% endfor %}
        </div>
      {% endif %}

      <!-- Blog Posts Grid -->
      {% paginate blog.articles by section.settings.posts_per_page %}
        <div class="gls-blog-grid">
          {% for article in blog.articles %}
            <article class="gls-article-card">
              <a href="{{ article.url }}" class="gls-article-card__image-wrapper">
                {% if article.image %}
                  <img 
                    src="{{ article.image | image_url: width: 600 }}" 
                    alt="{{ article.image.alt | escape }}" 
                    class="gls-article-card__image"
                    loading="lazy"
                  >
                {% else %}
                  {{ 'image' | placeholder_svg_tag: 'gls-article-card__image' }}
                {% endif %}
              </a>
              <div class="gls-article-card__content">
                <div class="gls-article-card__meta">
                  {{ article.published_at | time_tag: format: 'date' }}
                  {% if article.tags.size > 0 %}
                    â€¢ {{ article.tags.first }}
                  {% endif %}
                </div>
                <h2 class="gls-article-card__title">
                  <a href="{{ article.url }}">{{ article.title }}</a>
                </h2>
                <div class="gls-article-card__excerpt">
                  {% if article.excerpt.size > 0 %}
                    {{ article.excerpt | strip_html | truncatewords: 20 }}
                  {% else %}
                    {{ article.content | strip_html | truncatewords: 20 }}
                  {% endif %}
                </div>
                <a href="{{ article.url }}" class="gls-article-card__button">
                  Read Article
                </a>
              </div>
            </article>
          {% endfor %}
        </div>

        {% if paginate.pages > 1 %}
          <div class="gls-pagination">
            {{ paginate | default_pagination }}
          </div>
        {% endif %}
      {% endpaginate %}

    </div>
  </div>
</div>

{% schema %}
  /* Updated Icon Width Limit */
{
  "name": "Blog Page",
  "settings": [
    {
      "type": "header",
      "content": "Header / Icon Box"
    },
    {
      "type": "color",
      "id": "header_bg_color",
      "label": "Header Background",
      "default": "#ffffff"
    },
    {
      "type": "select",
      "id": "icon_position",
      "label": "Icon Position",
      "options": [
        { "value": "top", "label": "Top" },
        { "value": "left", "label": "Left" }
      ],
      "default": "top"
    },
    {
      "type": "checkbox",
      "id": "show_icon",
      "label": "Show Icon",
      "default": true
    },
    {
      "type": "select",
      "id": "icon",
      "label": "Icon",
      "options": [
        { "value": "leaf", "label": "Leaf" },
        { "value": "box", "label": "Box" },
        { "value": "star", "label": "Star" },
        { "value": "heart", "label": "Heart" }
      ],
      "default": "leaf"
    },
    {
      "type": "image_picker",
      "id": "custom_icon",
      "label": "Custom Icon Image",
      "info": "Overrides selected icon"
    },
    {
      "type": "range",
      "id": "icon_width",
      "min": 20,
      "max": 500,
      "step": 5,
      "unit": "px",
      "label": "Icon Width",
      "default": 48
    },
    {
      "type": "color",
      "id": "icon_color",
      "label": "Icon Color",
      "default": "#7AAE5C"
    },
    {
      "type": "header",
      "content": "Headline Settings"
    },
    {
      "type": "text",
      "id": "heading_text",
      "label": "Heading Text",
      "default": "Blog"
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "Heading Tag",
      "options": [
        { "value": "h1", "label": "H1" },
        { "value": "h2", "label": "H2" },
        { "value": "h3", "label": "H3" }
      ],
      "default": "h1"
    },
    {
      "type": "color",
      "id": "heading_color",
      "label": "Heading Color",
      "default": "#1a1a1a"
    },
    {
      "type": "range",
      "id": "heading_size",
      "min": 20,
      "max": 80,
      "step": 2,
      "unit": "px",
      "label": "Heading Size",
      "default": 48
    },
    {
      "type": "header",
      "content": "Tagline Settings"
    },
    {
      "type": "text",
      "id": "tagline_text",
      "label": "Tagline Text",
      "default": "Latest news and updates"
    },
    {
      "type": "color",
      "id": "tagline_color",
      "label": "Tagline Color",
      "default": "#666666"
    },
    {
      "type": "range",
      "id": "tagline_size",
      "min": 12,
      "max": 32,
      "step": 1,
      "unit": "px",
      "label": "Tagline Size",
      "default": 18
    },
    {
      "type": "header",
      "content": "Sidebar Settings"
    },
    {
      "type": "checkbox",
      "id": "show_search",
      "label": "Show Search Bar",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "show_categories",
      "label": "Show Categories List",
      "default": true
    },
    {
      "type": "color",
      "id": "sidebar_bg_color",
      "label": "Sidebar Background",
      "default": "#ffffff"
    },
    {
      "type": "color",
      "id": "sidebar_title_color",
      "label": "Sidebar Title Color",
      "default": "#333333"
    },
    {
      "type": "range",
      "id": "sidebar_title_size",
      "min": 14,
      "max": 32,
      "step": 1,
      "unit": "px",
      "label": "Sidebar Title Size",
      "default": 18
    },
    {
      "type": "header",
      "content": "Article Card Settings"
    },
    {
      "type": "color",
      "id": "article_title_color",
      "label": "Article Title Color",
      "default": "#1a1a1a"
    },
    {
      "type": "range",
      "id": "article_title_size",
      "min": 16,
      "max": 40,
      "step": 1,
      "unit": "px",
      "label": "Article Title Size",
      "default": 22
    },
    {
      "type": "color",
      "id": "button_bg_color",
      "label": "Button Background",
      "default": "#7AAE5C"
    },
    {
      "type": "color",
      "id": "button_text_color",
      "label": "Button Text Color",
      "default": "#ffffff"
    },
    {
      "type": "header",
      "content": "Grid Settings"
    },
    {
      "type": "range",
      "id": "posts_per_page",
      "min": 3,
      "max": 24,
      "step": 3,
      "default": 9,
      "label": "Posts per page"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top Padding",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom Padding",
      "default": 36
    }
  ],
  "blocks": [
    {
      "type": "category",
      "name": "Featured Category",
      "settings": [
        {
          "type": "text",
          "id": "tag",
          "label": "Tag Name",
          "info": "Must match a blog tag exactly"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Category Image"
        }
      ]
    }
  ]
}
{% endschema %}
